<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../css/wolai.css"/><title>Unity Mod 开发 - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body class="full-width"><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="Unity Mod 开发" class="main-title"></div></div></header><article><details class="wolai-block"><summary><div class="marker"></div><h3><span class="inline-wrap">BepInEx</span></h3></summary><div class="wolai-block wolai-text"><div><span class="inline-wrap">Unity<span class="jill"></span>打包方式</span></div><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">Mono 常规显示</span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">IL2CPP C#翻译成<span class="jill"></span>C++, 别人反编译看不到代码。用这种打包方式的游戏默认认为官方不允许<span class="jill"></span>Mod（但也能破）</span><div class="wolai-block wolai-text"><div><span class="inline-wrap">IL2CPP</span><span class="inline-wrap">游戏文件夹会多一个<span class="jill"></span>GameAssembly.dll</span></div></div></li></ul></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">BepInEx<span class="jill"></span>位</span></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">32<span class="jill"></span>位游戏用<span class="jill"></span>32<span class="jill"></span>位</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"> 游戏文件夹里可能找到游戏是多少位的</span></div></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">Steam<span class="jill"></span>的一个机制</span></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">如果不是从<span class="jill"></span>steam<span class="jill"></span>点开始游戏，steam<span class="jill"></span>会把游戏强制处重启一次，而这个重启会导致<span class="jill"></span>mod<span class="jill"></span>失效</span></div></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">BepInEx<span class="jill"></span>框架放进游戏目录启动游戏</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">BIE<span class="jill"></span>控制台</span></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">框架内</span><span class="inline-wrap"><code>config</code></span><span class="inline-wrap">文件夹 </span><span class="inline-wrap"><code>.cfg</code></span><span class="inline-wrap"> 文件，</span><span class="inline-wrap"><code>Logging.console</code></span><span class="inline-wrap">  </span><span class="inline-wrap"><code>Enable = true</code></span></div></div></div></details><details class="wolai-block"><summary><div class="marker"></div><h3><span class="inline-wrap">UnityExplorer</span></h3></summary><div class="wolai-block wolai-text"><div><span class="inline-wrap">官方下载，然后拖到<span class="jill"></span>BIE<span class="jill"></span>的</span><span class="inline-wrap"><code>plugins</code></span><span class="inline-wrap">文件夹</span></div></div></details><details class="wolai-block"><summary><div class="marker"></div><h3><span class="inline-wrap">Mod Helloword</span></h3></summary><details class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">VS 新建项目 </span></summary><ul class="wolai-block"><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>类库(.NET Framework)</code></span><span class="inline-wrap"> - </span><span class="inline-wrap"><code>类库(.NET Framework)</code></span></li><li><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">框架选择。</span><span class="inline-wrap"><a href="https://docs.bepinex.dev/articles/dev_guide/plugin_tutorial/2_plugin_start.html"><span>Doc </span></a></span><span class="inline-wrap">里有写什么情况应该选择什么版本</span><div class="wolai-block wolai-text"><div><span class="inline-wrap">if </span><span class="inline-wrap"><code>&lt;Game Name&gt;_Data - Managed </code></span><span class="inline-wrap">文件夹, 有</span><span class="inline-wrap"><code>netstandard2.0</code></span><span class="inline-wrap"> → </span><span class="inline-wrap"><code>net472</code></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">elif </span><span class="inline-wrap"><code>mscorlib.dll</code></span><span class="inline-wrap"> 文件版本大于<span class="jill"></span>4 → </span><span class="inline-wrap"><code>net46</code></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">else → </span><span class="inline-wrap"><code>net35</code></span></div></div></li></ul><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div></details><details class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"> 添加引用</span></summary><div class="wolai-block wolai-text"><div><span class="inline-wrap"><code>引用</code></span><span class="inline-wrap"> - </span><span class="inline-wrap"><code>添加引用</code></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><code>&lt;Game Name&gt;_Data - Managed</code></span><span class="inline-wrap"> 文件夹</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">Managed </span><span class="inline-wrap"><code>UnityEngine.CoreModule.dll</code></span><span class="inline-wrap"> , </span><span class="inline-wrap"><code>UnityEnging.dll</code></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">BIE -Core </span><span class="inline-wrap"><code>BepInEx.Core.dll</code></span><span class="inline-wrap">, </span><span class="inline-wrap"><code>BepInEx.Unity.dll</code></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">全选引用下除分析器的所有引用，</span><span class="inline-wrap"><code>复制本地=False</code></span></div></div></details><details class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">代码框架</span></summary><div class="wolai-block wolai-text"><div><span class="inline-wrap"><code>using BepInEx;</code></span><span class="inline-wrap"> </span><span class="inline-wrap"><code>using UnityEngine</code></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">基础类继承 </span><span class="inline-wrap"><code>BaseUnityPlugin</code></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">Mod 信息 </span><span class="inline-wrap"><code>[BepInPlugin(string GUID, string Name, string Version]</code></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">（F12<span class="jill"></span>单击类可以进入）</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">一般用<span class="jill"></span>Bep<span class="jill"></span>的<span class="jill"></span>logger<span class="jill"></span>输出日志，因为会显示插件名字</span></div></div><div class="wolai-block wolai-center"><figure style="width: 100%"><img src="media/image.png" style="width: 100%"/></figure></div></details><details class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">生成并安装<span class="jill"></span>Mod</span></summary><div class="wolai-block wolai-text"><div><span class="inline-wrap">右键项目生成，将生成的<span class="jill"></span>dll<span class="jill"></span>拖到<span class="jill"></span>BIE<span class="jill"></span>的</span><span class="inline-wrap"><code>plugins</code></span><span class="inline-wrap">文件夹</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">小技巧：右键项目，属性，生成，可以修改生成路径</span></div></div></details></details><details class="wolai-block"><summary><div class="marker"></div><h3><span class="inline-wrap">游戏代码分析</span></h3></summary><div class="wolai-block wolai-text"><div><span class="inline-wrap">准备</span></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><code>Assembly-CSharp.dll</code></span><span class="inline-wrap"> 拖进<span class="jill"></span>dnSpy. 大部分游戏的逻辑代码都在这，少部分游戏会把逻辑代码拆到几个<span class="jill"></span>dll</span></div></div></div></details><details class="wolai-block"><summary><div class="marker"></div><h3><span class="inline-wrap">做<span class="jill"></span>MOD</span></h3></summary><div class="wolai-block wolai-text"><div><span class="inline-wrap">引<span class="jill"></span>AC, 其他要什么引什么，比如键盘输入→</span><span class="inline-wrap"><code>UnityEngine.InputLegacy..</code></span><span class="inline-wrap">
没有<span class="jill"></span>Legacy<span class="jill"></span>的是新版，但一般用老的</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">键盘输入</span></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">if(Input.GetKeyDown(KeyCode.F12))</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><code>KeyCode.Alpha9</code></span><span class="inline-wrap"> 数字键<span class="jill"></span>9</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><code>KeyCode.Keypad9</code></span><span class="inline-wrap"> 小键盘<span class="jill"></span>9</span></div></div></div></details><details class="wolai-block"><summary><div class="marker"></div><h3><span class="inline-wrap">BepInEx<span class="jill"></span>配置文件</span></h3></summary><div class="wolai-block wolai-text"><div><span class="inline-wrap">这里用是<span class="jill"></span>ConfigEntry<span class="jill"></span>配置单项。更复杂的比如<span class="jill"></span>json</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><code>using BepInEx.Configuration;</code></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">声明</span></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><code>ConfigEntry&lt;KeyCode&gt; hotkey;</code></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><code>ConfigEntry&lt;int&gt; configInt;</code></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">泛型不能使用列表</span></div></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">使用</span></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">Start()</span></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><code>hotkey = Config.Bind&lt;KeyCode&gt;(&quot;config&quot;, &quot;hotkey&quot;, KeyCode.Alpha9, &quot;快捷键&quot;);</code></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">第一个参数是</span><span class="inline-wrap"><code>.cfg</code></span><span class="inline-wrap">文件里[]的名字</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">第二参数是一行的 xx=yy 中的<span class="jill"></span>xx</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">第三个是默认值</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">第四个是描述</span></div></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">Update()</span></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><code>if (Input.GetKeyDown(hotkey.Value))</code></span></div></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">会以<span class="jill"></span>GUID<span class="jill"></span>为名建一个配置文件</span></div></div></div></details><details class="wolai-block"><summary><div class="marker"></div><h3><span class="inline-wrap">Harmony<span class="jill"></span>基础</span></h3></summary><div class="wolai-block wolai-text"><div><span class="red inline-wrap">对游戏内方法进行补丁的库</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">方式：前置(Prefix), 后置(Postfix), ...</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">引用<span class="jill"></span>Bep 的</span><span class="inline-wrap"><code>0Harmony.dll</code></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b> 后置补丁函数示例</b></span></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">必须是<span class="jill"></span>static</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="C#" class="marker"></div><pre><span class="token punctuation">[</span><span class="token maybe-class-name">HarmonyPostfix</span><span class="token punctuation">,</span> <span class="token function"><span class="token maybe-class-name">HarmonyPatch</span></span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token maybe-class-name">StaticData</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"ShowJumpDamage"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment">//后置补丁，（函数所在类，函数名）</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function"><span class="token maybe-class-name">StaticData_ShowJumpDamage_PostPatch</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token maybe-class-name">StaticData</span> __instance<span class="token punctuation">,</span> int amout</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token maybe-class-name">Debug</span><span class="token punctuation">.</span><span class="token method function property-access"><span class="token maybe-class-name">Log</span></span><span class="token punctuation">(</span>$<span class="token string">"造成了伤害: {amount}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 内插字符串</span>
<span class="token punctuation">}</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap"><code>StaticData __instance</code></span><span class="inline-wrap"> 参数可以取到这个单例类的实例。在<span class="jill"></span>Doc<span class="jill"></span>的<span class="jill"></span>Patch - Injection</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">原函数是不止一个参数的，但这里只要取要用的</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">注意：静态方法不能直接使用<span class="jill"></span>Bep<span class="jill"></span>的</span><span class="inline-wrap"><code>Logger</code></span><span class="inline-wrap">, 只能直接用<span class="jill"></span>Unity<span class="jill"></span>的</span><span class="inline-wrap"><code>Debug.log</code></span><span class="inline-wrap">. 可以把<span class="jill"></span>Logger<span class="jill"></span>保存成静态</span></div></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">注入</span></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">start()</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">一般只要自动注入</span><span class="inline-wrap"><code>Harmony.CreateAndPatchAll(typeof(HelloWorld));</code></span></div></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">前置补丁</span></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">函数返回布尔类型，表示是否继续执行原函数</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">false<span class="jill"></span>拒绝后还可以执行后置补丁</span></div></div></div></details><details class="wolai-block"><summary><div class="marker"></div><h3><span class="inline-wrap">Harmony<span class="jill"></span>访问私有成员 Traverse</span></h3></summary><div class="wolai-block wolai-text"><div><span class="inline-wrap"> 根据类型查找类</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="C#" class="marker"></div><pre><span class="token keyword">var</span> gameLevelHolder <span class="token operator">=</span> <span class="token maybe-class-name">GameObject</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">FindObjectOfType</span></span><span class="token operator">&lt;</span><span class="token maybe-class-name">GameLevelHolder</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">Traverse<span class="jill"></span>挖掘私有空间。 </span><span class="inline-wrap"><code>.Field</code></span><span class="inline-wrap"> 是字段，</span><span class="inline-wrap"><code>.Property</code></span><span class="inline-wrap"> 属性，</span><span class="inline-wrap"><code>.Method</code></span><span class="inline-wrap">方法</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="C#" class="marker"></div><pre><span class="token keyword">var</span> m_WaveSystem <span class="token operator">=</span> <span class="token maybe-class-name">Traverse</span><span class="token punctuation">.</span><span class="token method function property-access"><span class="token maybe-class-name">Create</span></span><span class="token punctuation">(</span><span class="token maybe-class-name">GameManager</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Instance</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access"><span class="token maybe-class-name">Field</span></span><span class="token punctuation">(</span><span class="token string">"m_WaveSystem"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">GetValue</span></span><span class="token operator">&lt;</span><span class="token maybe-class-name">WaveSystem</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token maybe-class-name">Debug</span><span class="token punctuation">.</span><span class="token method function property-access"><span class="token maybe-class-name">Log</span></span><span class="token punctuation">(</span>$<span class="token string">"获取到私有字段m_WaveSystem:{m_WaveSystem.NextBossWave}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div></code-block><div class="wolai-block wolai-text"><div><span class="inline-wrap">对方法，</span><span class="inline-wrap"><code>GetValue()</code></span><span class="inline-wrap"> 无对应无输出，</span><span class="inline-wrap"><code>GetValue&lt;&gt;()</code></span><span class="inline-wrap"> 相应泛型返回值，如果方法本来有参数，在括号中可以带参</span></div></div></details><details class="wolai-block"><summary><div class="marker"></div><h3><span class="inline-wrap">Harmony 之 Patch<span class="jill"></span>属性，重载方法，</span><span class="inline-wrap"><code>ref</code></span><span class="inline-wrap">关键字</span></h3></summary><div class="wolai-block wolai-text"><div><span class="inline-wrap">讲的是详细匹配方法</span></div></div><details class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">比如<span class="jill"></span>Patch GameLevel<span class="jill"></span>的<span class="jill"></span>Setter<span class="jill"></span>方法 // 如果要构造器，</span><span class="inline-wrap"><code>&quot;GameLevel&quot;</code></span><span class="inline-wrap"> 去掉</span></summary><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="C#" class="marker"></div><pre><span class="token punctuation">[</span><span class="token maybe-class-name">HarmonyPostfix</span><span class="token punctuation">,</span> <span class="token function"><span class="token maybe-class-name">HarmonyPatch</span></span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token maybe-class-name">LevelManager</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"GameLevel"</span><span class="token punctuation">,</span> <span class="token maybe-class-name">Method</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Setter</span></span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function"><span class="token maybe-class-name">LevelManager_GameLevel_Set_PostPatch</span></span><span class="token punctuation">(</span><span class="token parameter">ref int value</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>

<span class="token punctuation">}</span></pre></div></code-block></details><div class="wolai-block wolai-text"><div><span class="inline-wrap">当要<span class="jill"></span>Patch<span class="jill"></span>的方法参数带<span class="jill"></span>ref，或者有多个重载，Harmony<span class="jill"></span>可能找不到方法</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">这时需要加上<span class="jill"></span>Type<span class="jill"></span>和<span class="jill"></span>ArgumentType</span></div></div><code-block class="wolai-block"><div class="wolai-pre"><div data-lang="C#" class="marker"></div><pre><span class="token punctuation">[</span><span class="token maybe-class-name">HarmonyPostfix</span><span class="token punctuation">,</span> <span class="token function"><span class="token maybe-class-name">HarmonyPatch</span></span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token maybe-class-name">Matf</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"SmoothDamp"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Type</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token keyword">typeof</span><span class="token punctuation">(</span>float<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span>float<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span>float<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span>float<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ArgumentType</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><span class="token maybe-class-name">ArgumentType</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Normal</span></span><span class="token punctuation">,</span> <span class="token maybe-class-name">ArgumentType</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Normal</span></span><span class="token punctuation">,</span> <span class="token maybe-class-name">ArgumentType</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Ref</span></span><span class="token punctuation">,</span> <span class="token maybe-class-name">ArgumentType</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Normal</span></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function"><span class="token maybe-class-name">Mathf_GameLevel_Set_PostPatch</span></span><span class="token punctuation">(</span>float currentVelocity<span class="token punctuation">)</span>
<span class="token comment">// 要改的 curretnVelocity 参数是 ref</span>
<span class="token punctuation">{</span>

<span class="token punctuation">}</span></pre></div></code-block></details></article><footer></footer></body></html>